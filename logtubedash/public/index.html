<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Logtube Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha256-YLGeXaapI0/5IgZopewRJcFXomhRMlYYjugPLSyNjTY=" crossorigin="anonymous">
</head>
<body>

<div class="container-fluid">
    <div class="row mt-4">
        <div class="col-md-12">
            <h1>Logtube Dashboard</h1>
            <hr/>
        </div>
    </div>
    <div id="main" class="row mt-4">
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"
        integrity="sha256-Uv9BNBucvCPipKQ2NS9wYpJmi8DTOEfTA/nH2aoJALw=" crossorigin="anonymous"></script>
<script>
    function collectLabel(arr) {
        out = []
        for (var i = 0; i < arr.length; i++) {
            out.push(arr[i].time)
        }
        return out
    }

    function collectValue(arr, invert) {
        out = []
        for (var i = 0; i < arr.length; i++) {
            if (invert) {
                out.push(-arr[i].value)
            } else {
                out.push(arr[i].value)
            }
        }
        return out
    }

    $.getJSON("/logtubedash/api/stats", function (data) {
        for (var i = 0; i < data.length; i++) {
            $("#main").append('<div class="col-md-12"><b>Logtube ' + (i + 1) + ' Throughput</b><br /><canvas style="width: 100%; height: 320px;" id="chart-t-' + i + '"></canvas><br /><b>Logtube ' + (i + 1) + ' Queue Depth</b><br /><canvas style="width: 100%; height: 320px;" id="chart-d-' + i + '"></canvas></div>')
        }
        setTimeout(function () {
                for (var i = 0; i < data.length; i++) {
                    var ctxT = document.getElementById('chart-t-' + i).getContext('2d');
                    var datasetT = {
                        type: 'line',
                        data: {
                            labels: collectLabel(data[i].queue_depth),
                            datasets: [{
                                label: 'In',
                                backgroundColor: 'rgba(241,196,15,0.4)',
                                fill: true,
                                data: collectValue(data[i].queue_in),
                            }, {
                                label: 'Out',
                                backgroundColor: 'rgba(41,128,185,0.4)',
                                fill: true,
                                data: collectValue(data[i].queue_out, true),
                            }]
                        },
                        options: {
                            responsive: true,
                        }
                    }
                    new Chart(ctxT, datasetT)
                    var ctxD = document.getElementById('chart-d-' + i).getContext('2d');
                    var datasetD = {
                        type: 'line',
                        data: {
                            labels: collectLabel(data[i].queue_depth),
                            datasets: [{
                                label: 'Depth',
                                borderColor: '#2c3e50',
                                fill: false,
                                data: collectValue(data[i].queue_depth),
                            }]
                        },
                        options: {
                            responsive: true,
                        }
                    }
                    new Chart(ctxD, datasetD)
                }
            }
        )
    })
</script>
</body>
</html>